(function(){var CLEANUP_INTERVAL,checkForUrlHourInterval,checkForUrl_Persistent_ChromeNotification_HourInterval,check_updateServiceResults,defaultServicesInfo,defaultUserPreferences,dispatchGnewsQuery,dispatchGnewsQuery__customSearch,dispatchQuery,dispatchQuery__customSearch,getRandom,getUrlResults_to_refreshBadgeIcon,initIfNewURL,initialize,is_url_blocked,kiwi_autoOffClearInterval,kiwi_customSearchResults,kiwi_reddit_token_refresh_interval,kiwi_urlsResultsCache,last_periodicCleanup,maxUrlResultsStoredInLocalStorage,newsSearch,onGoogleLoad,parseResults,periodicCleanup,popupOpen,popupParcel,queryThrottleSeconds,randomishDeviceId,reduceHashByHalf,refreshBadge,requestRedditOathToken,returnNumberOfActiveServices,sendParcel,serviceQueryTimestamps,setAutoOffTimer,setPreppedServiceResults,setPreppedServiceResults__customSearch,setTimeout_forRedditRefresh,tabTitleObject,tabUrl,tempResponsesStore,turnResearchModeOff,updateBadgeText,__randomishStringPadding,_exact_match_url_check,_save_a_la_carte,_save_from_popupParcel,_save_historyBlob,_save_url_results,_set_popupParcel;tabUrl="",tabTitleObject=null,popupOpen=!1,checkForUrlHourInterval=16,checkForUrl_Persistent_ChromeNotification_HourInterval=3,last_periodicCleanup=0,CLEANUP_INTERVAL=108e5,queryThrottleSeconds=3,serviceQueryTimestamps={},maxUrlResultsStoredInLocalStorage=800,kiwi_urlsResultsCache={},kiwi_customSearchResults={},kiwi_autoOffClearInterval=null,kiwi_reddit_token_refresh_interval=null,tempResponsesStore={},randomishDeviceId=function(){var characterCounter,randomASCIIcharcode,randomClientLength,randomString;for(randomClientLength=getRandom(21,29),characterCounter=0,randomString="";randomClientLength>=characterCounter;)characterCounter++,randomASCIIcharcode=getRandom(33,125),randomString+=String.fromCharCode(randomASCIIcharcode);return randomString},requestRedditOathToken=function(kiwi_reddit_oauth){var currentTime,queryObj;return currentTime=Date.now(),queryObj={type:"POST",data:{grant_type:"https://oauth.reddit.com/grants/installed_client",device_id:kiwi_reddit_oauth.device_id},url:"https://www.reddit.com/api/v1/access_token",headers:{Authorization:"Basic "+btoa(kiwi_reddit_oauth.client_id+":"),"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"csrf suck it "+getRandom(1,1e7)},cache:!1,async:!0,success:function(data){var setObj,token_lifespan_timestamp;return null!=data.access_token&&null!=data.expires_in&&"bearer"===data.token_type?(token_lifespan_timestamp=currentTime+1e3*data.expires_in,setObj={},setObj.kiwi_reddit_oauth={token:data.access_token,token_type:"bearer",token_lifespan_timestamp:token_lifespan_timestamp,client_id:kiwi_reddit_oauth.client_id,device_id:kiwi_reddit_oauth.device_id},chrome.storage.local.set(setObj,function(data){return setTimeout_forRedditRefresh(token_lifespan_timestamp,setObj.kiwi_reddit_oauth)})):void 0},fail:function(data){return setTimeout(function(){return requestRedditOathToken(kiwi_reddit_oauth)},3e5)}},$.ajax(queryObj)},chrome.storage.local.get(null,function(allItemsInLocalStorage){var currentTime,setObj,token_timestamp;return currentTime=Date.now(),setObj={},setObj.kiwi_reddit_oauth={token:null,token_type:null,token_lifespan_timestamp:null,client_id:"",device_id:randomishDeviceId()},null==allItemsInLocalStorage.kiwi_reddit_oauth||null==allItemsInLocalStorage.kiwi_reddit_oauth.token?chrome.storage.local.set(setObj,function(data){return requestRedditOathToken(setObj.kiwi_reddit_oauth)}):null!=allItemsInLocalStorage.kiwi_reddit_oauth.token_lifespan_timestamp&&currentTime>allItemsInLocalStorage.kiwi_reddit_oauth.token_lifespan_timestamp||null==allItemsInLocalStorage.kiwi_reddit_oauth.token_lifespan_timestamp?requestRedditOathToken(setObj.kiwi_reddit_oauth):null!=allItemsInLocalStorage.kiwi_reddit_oauth.token_lifespan_timestamp&&null!=allItemsInLocalStorage.kiwi_reddit_oauth&&(token_timestamp=allItemsInLocalStorage.kiwi_reddit_oauth.token_lifespan_timestamp,null==kiwi_reddit_token_refresh_interval||kiwi_reddit_token_refresh_interval.timestamp!==token_timestamp)?setTimeout_forRedditRefresh(token_timestamp,allItemsInLocalStorage.kiwi_reddit_oauth):void 0}),setTimeout_forRedditRefresh=function(token_timestamp,kiwi_reddit_oauth){var currentTime,timeoutDelay,timeoutIntervalId;return currentTime=Date.now(),null!=kiwi_reddit_token_refresh_interval&&null!=kiwi_reddit_token_refresh_interval.timestamp&&clearTimeout(kiwi_reddit_token_refresh_interval.intervalId),timeoutDelay=token_timestamp-currentTime,timeoutIntervalId=setTimeout(function(){return requestRedditOathToken(kiwi_reddit_oauth)},timeoutDelay),kiwi_reddit_token_refresh_interval={timestamp:token_timestamp,intervalId:timeoutIntervalId}},"undefined"!=typeof google&&null!==google&&google.load("search","1"),newsSearch=null,onGoogleLoad=function(){return newsSearch=new google.search.NewsSearch,newsSearch.setNoHtmlGeneration()},google.setOnLoadCallback(onGoogleLoad),popupParcel={},defaultUserPreferences={fontSize:.8,researchModeOnOff:"on",autoOffAtUTCmilliTimestamp:null,autoOffTimerType:"always",autoOffTimerValue:null,sortByPref:"attention",urlSubstring_blacklists:{anyMatch:["facebook.com","news.ycombinator.com","reddit.com","imgur.com","www.google.com","docs.google","drive.google","accounts.google",".slack.com/","//t.co","//bit.ly","//goo.gl","//mail.google","//mail.yahoo.com","hotmail.com","outlook.com","chrome://","chrome-extension://","chrome-devtools://"],beginsWith:["about:","chrome://"],endingIn:["youtube.com"],unless:[["twitter.com/","/status/"]]}},is_url_blocked=function(blockedLists,url){var urlSubstring,urlSubstringArray,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref,_ref1,_ref2,_ref3;if(null!=blockedLists.anyMatch)for(_ref=blockedLists.anyMatch,_i=0,_len=_ref.length;_len>_i;_i++)if(urlSubstring=_ref[_i],-1!==url.indexOf(urlSubstring))return!0;if(null!=blockedLists.beginsWith)for(_ref1=blockedLists.beginsWith,_j=0,_len1=_ref1.length;_len1>_j;_j++)if(urlSubstring=_ref1[_j],0===url.indexOf(urlSubstring))return!0;if(null!=blockedLists.endingIn)for(_ref2=blockedLists.endingIn,_k=0,_len2=_ref2.length;_len2>_k;_k++){if(urlSubstring=_ref2[_k],url.indexOf(urlSubstring)===url.length-urlSubstring.length)return!0;if(urlSubstring+="/",url.indexOf(urlSubstring)===url.length-urlSubstring.length)return!0}if(null!=blockedLists.unless)for(_ref3=blockedLists.unless,_l=0,_len3=_ref3.length;_len3>_l;_l++)if(urlSubstringArray=_ref3[_l],-1!==url.indexOf(urlSubstringArray[0])&&-1===url.indexOf(urlSubstringArray[1]))return!0;return!1},defaultServicesInfo=[{name:"hackerNews",title:"Hacker News",abbreviation:"H",queryApi:"https://hn.algolia.com/api/v1/search?restrictSearchableAttributes=url&query=",broughtToYouByTitle:"Algolia Hacker News API",broughtToYouByURL:"https://hn.algolia.com/api",permalinkBase:"https://news.ycombinator.com/item?id=",userPageBaselink:"https://news.ycombinator.com/user?id=",submitTitle:"Be the first to submit on Hacker News!",submitUrl:"https://news.ycombinator.com/submit",active:"on",notableConditions:{hoursSincePosted:4,num_comments:10},updateBadgeOnlyWithExactMatch:!0,customSearchApi:"https://hn.algolia.com/api/v1/search?query=",customSearchTags__convention:{string:"&tags=",delimeter:","},customSearchTags:{story:{title:"stories",string:"story",include:!0},commentPolls:{title:"comments or polls",string:"(comment,poll,pollopt)",include:!1},showHnAskHn:{title:"Show HN or Ask HN",string:"(show_hn,ask_hn)",include:!1}}},{name:"reddit",title:"Reddit",abbreviation:"R",queryApi:"https://www.reddit.com/submit.json?url=",broughtToYouByTitle:"Reddit API",broughtToYouByURL:"https://github.com/reddit/reddit/wiki/API",permalinkBase:"https://www.reddit.com",userPageBaselink:"https://www.reddit.com/user/",submitTitle:"Be the first to submit on Reddit!",submitUrl:"https://www.reddit.com/submit",active:"on",notableConditions:{hoursSincePosted:1,num_comments:30},updateBadgeOnlyWithExactMatch:!0,customSearchApi:"https://www.reddit.com/search.json?q=",customSearchTags:{}},{name:"gnews",title:"Google News",abbreviation:"G",broughtToYouByTitle:"Google News Search",broughtToYouByURL:"https://developers.google.com/news-search/v1/devguide",permalinkBase:"",userPageBaselink:"",active:"on",submitTitle:null,submitUrl:null,notableConditions:{numberOfRelatedItemsWithClusterURL:2,numberOfStoriesFoundWithinTheHoursSincePostedLimit:4,hoursSincePosted:3},customSearchTags:{}}],returnNumberOfActiveServices=function(servicesInfo){var numberOfActiveServices,service,_i,_len;for(numberOfActiveServices=0,_i=0,_len=servicesInfo.length;_len>_i;_i++)service=servicesInfo[_i],"on"===service.active&&numberOfActiveServices++;return numberOfActiveServices},sendParcel=function(parcel){var outPort;if(outPort=chrome.extension.connect({name:"kiwi_fromBackgroundToPopup"}),null==parcel.msg||null==parcel.forUrl)return!1;switch(parcel.msg){case"kiwiPP_popupParcel_ready":return outPort.postMessage(parcel)}},_save_a_la_carte=function(parcel){var setObj;return setObj={},setObj[parcel.keyName]=parcel.newValue,chrome.storage[parcel.localOrSync].set(setObj,function(data){var tempResponsesStoreServices;return tempResponsesStoreServices=null==tempResponsesStore||null==tempResponsesStore.services?{}:tempResponsesStore.services,null!=parcel.refreshView?_set_popupParcel(tempResponsesStoreServices,tabUrl,!0,parcel.refreshView):_set_popupParcel(tempResponsesStoreServices,tabUrl,!1)})},chrome.extension.onConnect.addListener(function(port){return"kiwi_fromBackgroundToPopup"===port.name?(popupOpen=!0,port.onMessage.addListener(function(dataFromPopup){var newResultsBool,parcel,preppedResponsesInPopupParcel,preppedResponsesInTempResponsesStore,service,serviceName,_ref,_ref1;if(null==dataFromPopup.msg)return!1;switch(dataFromPopup.msg){case"kiwiPP_post_customSearch":if(null!=dataFromPopup.customSearchRequest&&null!=dataFromPopup.customSearchRequest.queryString&&""!==dataFromPopup.customSearchRequest.queryString)return chrome.storage.sync.get(null,function(allItemsInSyncedStorage){var serviceInfoObject,_i,_len,_ref,_results;if(null!=allItemsInSyncedStorage.kiwi_servicesInfo){for(_ref=allItemsInSyncedStorage.kiwi_servicesInfo,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)serviceInfoObject=_ref[_i],_results.push(null!=dataFromPopup.customSearchRequest.servicesToSearch[serviceInfoObject.name]?"gnews"===serviceInfoObject.name?dispatchGnewsQuery__customSearch(dataFromPopup.customSearchRequest.queryString,dataFromPopup.customSearchRequest.servicesToSearch,serviceInfoObject,allItemsInSyncedStorage.kiwi_servicesInfo):null!=serviceInfoObject.customSearchApi&&""!==serviceInfoObject.customSearchApi?dispatchQuery__customSearch(dataFromPopup.customSearchRequest.queryString,dataFromPopup.customSearchRequest.servicesToSearch,serviceInfoObject,allItemsInSyncedStorage.kiwi_servicesInfo):void 0:void 0);return _results}});break;case"kiwiPP_researchUrlOverrideButton":return initIfNewURL(!0,!0);case"kiwiPP_clearAllURLresults":return updateBadgeText(""),kiwi_urlsResultsCache={},tempResponsesStore={},_set_popupParcel({},tabUrl,!0);case"kiwiPP_refreshSearchQuery":return kiwi_customSearchResults={},tempResponsesStore.forUrl===tabUrl?_set_popupParcel(tempResponsesStore.services,tabUrl,!0):null!=kiwi_urlsResultsCache[tabUrl]?_set_popupParcel(kiwi_urlsResultsCache[tabUrl],tabUrl,!0):_set_popupParcel({},tabUrl,!0);case"kiwiPP_refreshURLresults":return null!=kiwi_urlsResultsCache&&null!=kiwi_urlsResultsCache[tabUrl]&&delete kiwi_urlsResultsCache[tabUrl],tempResponsesStore={},initIfNewURL(!0);case"kiwiPP_reset_timer":return dataFromPopup.kiwi_userPreferences.autoOffAtUTCmilliTimestamp=setAutoOffTimer(!0,dataFromPopup.kiwi_userPreferences.autoOffAtUTCmilliTimestamp,dataFromPopup.kiwi_userPreferences.autoOffTimerValue,dataFromPopup.kiwi_userPreferences.autoOffTimerType,dataFromPopup.kiwi_userPreferences.researchModeOnOff),parcel={refreshView:"userPreferences",keyName:"kiwi_userPreferences",newValue:dataFromPopup.kiwi_userPreferences,localOrSync:"sync"},_save_a_la_carte(parcel);case"kiwiPP_post_save_a_la_carte":return console.log("when 'kiwiPP_post_save_a_la_carte'"),_save_a_la_carte(dataFromPopup);case"kiwiPP_post_savePopupParcel":if(_save_from_popupParcel(dataFromPopup.newPopupParcel,dataFromPopup.forUrl,dataFromPopup.refreshView),null!=kiwi_urlsResultsCache[tabUrl])return refreshBadge(dataFromPopup.newPopupParcel.kiwi_servicesInfo,kiwi_urlsResultsCache[tabUrl]);break;case"kiwiPP_request_popupParcel":if(dataFromPopup.forUrl===tabUrl){if(preppedResponsesInPopupParcel=0,null!=popupParcel&&null!=popupParcel.allPreppedResults){_ref=popupParcel.allPreppedResults;for(serviceName in _ref)service=_ref[serviceName],null!=service.service_PreppedResults&&(preppedResponsesInPopupParcel+=service.service_PreppedResults.length)}if(preppedResponsesInTempResponsesStore=0,null!=tempResponsesStore&&null!=tempResponsesStore.services){_ref1=tempResponsesStore.services;for(serviceName in _ref1)service=_ref1[serviceName],preppedResponsesInTempResponsesStore+=service.service_PreppedResults.length}return newResultsBool=!1,tempResponsesStore.forUrl===tabUrl&&preppedResponsesInTempResponsesStore!==preppedResponsesInPopupParcel&&(newResultsBool=!0),null!=popupParcel&&popupParcel.forUrl===tabUrl&&newResultsBool===!1?(parcel={},parcel.msg="kiwiPP_popupParcel_ready",parcel.forUrl=tabUrl,parcel.popupParcel=popupParcel,sendParcel(parcel)):null==tempResponsesStore.services||tempResponsesStore.forUrl!==tabUrl?_set_popupParcel({},tabUrl,!0):_set_popupParcel(tempResponsesStore.services,tabUrl,!0)}}})):void 0}),initialize=function(currentUrl){return chrome.storage.sync.get(null,function(allItemsInSyncedStorage){return null==allItemsInSyncedStorage.kiwi_servicesInfo?chrome.storage.sync.set({kiwi_servicesInfo:defaultServicesInfo},function(servicesInfo){return getUrlResults_to_refreshBadgeIcon(defaultServicesInfo,currentUrl)}):getUrlResults_to_refreshBadgeIcon(allItemsInSyncedStorage.kiwi_servicesInfo,currentUrl)})},getUrlResults_to_refreshBadgeIcon=function(servicesInfo,currentUrl){var currentTime,sendPopupParcel,service,_i,_len;if(currentTime=Date.now(),Object.keys(kiwi_urlsResultsCache).length>0){if(null!=kiwi_urlsResultsCache[currentUrl]){for(refreshBadge(servicesInfo,kiwi_urlsResultsCache[currentUrl]),_i=0,_len=servicesInfo.length;_len>_i;_i++){if(service=servicesInfo[_i],null==kiwi_urlsResultsCache[currentUrl][service.name])return check_updateServiceResults(servicesInfo,currentUrl,kiwi_urlsResultsCache),0;if(currentTime-kiwi_urlsResultsCache[currentUrl][service.name].timestamp>36e5*checkForUrlHourInterval)return check_updateServiceResults(servicesInfo,currentUrl,kiwi_urlsResultsCache),0}return tempResponsesStore.forUrl=currentUrl,tempResponsesStore.services=kiwi_urlsResultsCache[currentUrl],sendPopupParcel=popupOpen?!0:!1,_set_popupParcel(tempResponsesStore.services,currentUrl,sendPopupParcel)}return check_updateServiceResults(servicesInfo,currentUrl,kiwi_urlsResultsCache)}return check_updateServiceResults(servicesInfo,currentUrl,null)},_save_url_results=function(servicesInfo,tempResponsesStore,_urlsResultsCache){var previousUrl,service,urlsResultsCache,_i,_len;if(urlsResultsCache=_.extend({},_urlsResultsCache),previousUrl=tempResponsesStore.forUrl,null!=urlsResultsCache[previousUrl])for(_i=0,_len=servicesInfo.length;_len>_i;_i++)service=servicesInfo[_i],null!=tempResponsesStore.services[service.name]&&(urlsResultsCache[previousUrl][service.name]={forUrl:previousUrl,timestamp:tempResponsesStore.services[service.name].timestamp,service_PreppedResults:tempResponsesStore.services[service.name].service_PreppedResults});else urlsResultsCache[previousUrl]={},urlsResultsCache[previousUrl]=tempResponsesStore.services;return urlsResultsCache},__randomishStringPadding=function(){var characterCounter,paddingString,randomLatinKeycode,randomPaddingLength;for(randomPaddingLength=getRandom(2,4),characterCounter=0,paddingString="";randomPaddingLength>=characterCounter;)randomLatinKeycode=getRandom(33,265),String.fromCharCode(randomLatinKeycode),paddingString+=String.fromCharCode(randomLatinKeycode),characterCounter++;return paddingString},_save_historyBlob=function(kiwi_urlsResultsCache,tabUrl){var tabUrl_hash,tabUrl_hashWordArray;return tabUrl_hashWordArray=CryptoJS.SHA512(tabUrl),tabUrl_hash=tabUrl_hashWordArray.toString(CryptoJS.enc.Latin1),chrome.storage.local.get(null,function(allItemsInLocalStorage){var historyString,newKiwi_historyBlob,paddedHistoryString;return historyString=reduceHashByHalf(tabUrl_hash),paddedHistoryString=__randomishStringPadding()+historyString,null!=allItemsInLocalStorage.kiwi_historyBlob&&"string"==typeof allItemsInLocalStorage.kiwi_historyBlob&&allItemsInLocalStorage.kiwi_historyBlob.indexOf(historyString)<15e3&&-1!==allItemsInLocalStorage.kiwi_historyBlob.indexOf(historyString)?0:(null==allItemsInLocalStorage.kiwi_historyBlob&&(paddedHistoryString+=__randomishStringPadding()),newKiwi_historyBlob=null!=allItemsInLocalStorage.kiwi_historyBlob?paddedHistoryString+allItemsInLocalStorage.kiwi_historyBlob:paddedHistoryString,null!=allItemsInLocalStorage.kiwi_historyBlob&&allItemsInLocalStorage.kiwi_historyBlob.indexOf(historyString)>17e3&&(newKiwi_historyBlob=newKiwi_historyBlob.substring(0,15500)),chrome.storage.local.set({kiwi_historyBlob:newKiwi_historyBlob},function(){}))})},check_updateServiceResults=function(servicesInfo,currentUrl,urlsResultsCache){var currentTime,previousResponsesStore,service,_i,_len,_results,_urlsResultsCache;for(null==urlsResultsCache&&(urlsResultsCache=null),null!=urlsResultsCache&&Object.keys(tempResponsesStore).length>0&&(previousResponsesStore=_.extend({},tempResponsesStore),_urlsResultsCache=_.extend({},urlsResultsCache),kiwi_urlsResultsCache=_save_url_results(servicesInfo,previousResponsesStore,_urlsResultsCache),_save_historyBlob(kiwi_urlsResultsCache,previousResponsesStore.forUrl)),tempResponsesStore.forUrl=currentUrl,tempResponsesStore.services={},currentTime=Date.now(),null==urlsResultsCache&&(urlsResultsCache={}),null==urlsResultsCache[currentUrl]&&(urlsResultsCache[currentUrl]={}),_results=[],_i=0,_len=servicesInfo.length;_len>_i;_i++)service=servicesInfo[_i],_results.push("on"===service.active?null!=urlsResultsCache[currentUrl][service.name]?currentTime-urlsResultsCache[currentUrl][service.name].timestamp>36e5*checkForUrlHourInterval?"gnews"===service.name?dispatchGnewsQuery(service,currentUrl,servicesInfo):dispatchQuery(service,currentUrl,servicesInfo):void 0:"gnews"===service.name?dispatchGnewsQuery(service,currentUrl,servicesInfo):dispatchQuery(service,currentUrl,servicesInfo):void 0);return _results},dispatchGnewsQuery=function(service_info,currentUrl,servicesInfo){var currentTime;if(currentTime=Date.now(),null!=newsSearch&&null!=tabTitleObject&&tabTitleObject.forUrl===currentUrl&&null!==tabTitleObject.tabTitle&&""!==tabTitleObject.tabTitle){if(null==serviceQueryTimestamps[service_info.name])serviceQueryTimestamps[service_info.name]=currentTime;else{if(currentTime-serviceQueryTimestamps[service_info.name]<1e3*queryThrottleSeconds)return setTimeout(function(){return currentUrl===tabUrl?dispatchGnewsQuery(service_info,currentUrl,servicesInfo):void 0},2e3),0;serviceQueryTimestamps[service_info.name]=currentTime}return newsSearch.setSearchCompleteCallback(this,function(){var responsePackage,results;return results=_.isArray(newsSearch.results)?newsSearch.results:[],responsePackage={forUrl:currentUrl,servicesInfo:servicesInfo,serviceName:service_info.name,queryResult:results},setPreppedServiceResults(responsePackage,servicesInfo)}),newsSearch.execute(tabTitleObject.tabTitle)}},dispatchQuery=function(service_info,currentUrl,servicesInfo){var currentTime;if(currentTime=Date.now(),null==serviceQueryTimestamps[service_info.name])serviceQueryTimestamps[service_info.name]=currentTime;else{if(currentTime-serviceQueryTimestamps[service_info.name]<1e3*queryThrottleSeconds)return setTimeout(function(){return dispatchQuery(service_info,currentUrl,servicesInfo)},2e3),0;serviceQueryTimestamps[service_info.name]=currentTime}return chrome.storage.local.get(null,function(allItemsInLocalStorage){var queryObj;return queryObj={type:"GET",url:service_info.queryApi+encodeURIComponent(currentUrl),success:function(queryResult){var responsePackage;return responsePackage={forUrl:currentUrl,servicesInfo:servicesInfo,serviceName:service_info.name,queryResult:queryResult},setPreppedServiceResults(responsePackage,servicesInfo)}},"reddit"===service_info.name&&null!=allItemsInLocalStorage.kiwi_reddit_oauth&&(queryObj.headers={Authorization:"'bearer "+allItemsInLocalStorage.kiwi_reddit_oauth+"'"}),$.ajax(queryObj)})},dispatchGnewsQuery__customSearch=function(customSearchQuery,servicesToSearch,service_info,servicesInfo){var currentTime;if(currentTime=Date.now(),null!=newsSearch){if(null==serviceQueryTimestamps[service_info.name])serviceQueryTimestamps[service_info.name]=currentTime;else{if(currentTime-serviceQueryTimestamps[service_info.name]<1e3*queryThrottleSeconds)return setTimeout(function(){return dispatchGnewsQuery__customSearch(service_info,customSearchQuery,servicesInfo)},1e3*queryThrottleSeconds),0;serviceQueryTimestamps[service_info.name]=currentTime}return newsSearch.setSearchCompleteCallback(this,function(){var responsePackage,results;return results=_.isArray(newsSearch.results)?newsSearch.results:[],responsePackage={servicesInfo:servicesInfo,servicesToSearch:servicesToSearch,customSearchQuery:customSearchQuery,serviceName:service_info.name,queryResult:results},setPreppedServiceResults__customSearch(responsePackage,servicesInfo)}),newsSearch.execute(customSearchQuery)}},dispatchQuery__customSearch=function(customSearchQuery,servicesToSearch,service_info,servicesInfo){var currentTime,queryUrl,tagIdentifier,tagObject,_ref;if(currentTime=Date.now(),null==serviceQueryTimestamps[service_info.name])serviceQueryTimestamps[service_info.name]=currentTime;else{if(currentTime-serviceQueryTimestamps[service_info.name]<1e3*queryThrottleSeconds)return setTimeout(function(){return dispatchQuery__customSearch(customSearchQuery,servicesToSearch,service_info,servicesInfo)},2e3),0;serviceQueryTimestamps[service_info.name]=currentTime}if(queryUrl=service_info.customSearchApi+encodeURIComponent(customSearchQuery),null!=servicesToSearch[service_info.name].customSearchTags&&Object.keys(servicesToSearch[service_info.name].customSearchTags).length>0){_ref=servicesToSearch[service_info.name].customSearchTags;for(tagIdentifier in _ref)tagObject=_ref[tagIdentifier],queryUrl=queryUrl+service_info.customSearchTags__convention.string+service_info.customSearchTags[tagIdentifier].string}return chrome.storage.local.get(null,function(allItemsInLocalStorage){var queryObj;return queryObj={type:"GET",url:queryUrl,success:function(queryResult){var responsePackage;return responsePackage={servicesInfo:servicesInfo,serviceName:service_info.name,queryResult:queryResult,servicesToSearch:servicesToSearch,customSearchQuery:customSearchQuery},setPreppedServiceResults__customSearch(responsePackage,servicesInfo)}},"reddit"===service_info.name&&null!=allItemsInLocalStorage.kiwi_reddit_oauth&&(queryObj.headers={Authorization:"'bearer "+allItemsInLocalStorage.kiwi_reddit_oauth+"'"}),$.ajax(queryObj)})},setPreppedServiceResults__customSearch=function(responsePackage,servicesInfo){var completedQueryServicesArray,currentTime,numberOfActiveServices,service,serviceInfo,serviceName,serviceObj,service_PreppedResults,_i,_len,_ref;for(currentTime=Date.now(),_i=0,_len=servicesInfo.length;_len>_i;_i++)serviceObj=servicesInfo[_i],serviceObj.name===responsePackage.serviceName&&(serviceInfo=serviceObj);if(service_PreppedResults=parseResults[responsePackage.serviceName](responsePackage.queryResult,responsePackage.customSearchQuery,serviceInfo,!0),null!=kiwi_customSearchResults&&null!=kiwi_customSearchResults.queryString&&kiwi_customSearchResults.queryString===responsePackage.customSearchQuery?(kiwi_customSearchResults.servicesSearched[responsePackage.serviceName]={},kiwi_customSearchResults.servicesSearched[responsePackage.serviceName].results=service_PreppedResults):(kiwi_customSearchResults={},kiwi_customSearchResults.queryString=responsePackage.customSearchQuery,kiwi_customSearchResults.servicesSearchesRequested=responsePackage.servicesToSearch,kiwi_customSearchResults.servicesSearched={},kiwi_customSearchResults.servicesSearched[responsePackage.serviceName]={},kiwi_customSearchResults.servicesSearched[responsePackage.serviceName].results=service_PreppedResults),numberOfActiveServices=Object.keys(responsePackage.servicesToSearch).length,completedQueryServicesArray=[],kiwi_customSearchResults.queryString===responsePackage.customSearchQuery){_ref=kiwi_customSearchResults.servicesSearched;for(serviceName in _ref)service=_ref[serviceName],completedQueryServicesArray.push(serviceName)}return completedQueryServicesArray=_.uniq(completedQueryServicesArray),completedQueryServicesArray.length===numberOfActiveServices&&0!==numberOfActiveServices?null!=kiwi_urlsResultsCache[tabUrl]?_set_popupParcel(kiwi_urlsResultsCache[tabUrl],tabUrl,!0):_set_popupParcel({},tabUrl,!0):void 0},_set_popupParcel=function(setWith_urlResults,forUrl,sendPopupParcel,renderView,oldUrl){var setObj_popupParcel;return null==setWith_urlResults&&(setWith_urlResults={}),null==renderView&&(renderView=null),null==oldUrl&&(oldUrl=!1),setWith_urlResults!=={}&&forUrl!==tabUrl?(console.log("_set_popupParcel request for old url"),!1):(setObj_popupParcel={},setObj_popupParcel.forUrl=tabUrl,chrome.storage.sync.get(null,function(allItemsInSyncedStorage){var isUrlBlocked,parcel;return null==allItemsInSyncedStorage.kiwi_userPreferences?setObj_popupParcel.kiwi_userPreferences=defaultUserPreferences:setObj_popupParcel.kiwi_userPreferences=allItemsInSyncedStorage.kiwi_userPreferences,null==allItemsInSyncedStorage.kiwi_servicesInfo?setObj_popupParcel.kiwi_servicesInfo=defaultServicesInfo:setObj_popupParcel.kiwi_servicesInfo=allItemsInSyncedStorage.kiwi_servicesInfo,null!==renderView&&(setObj_popupParcel.view=renderView),setObj_popupParcel.kiwi_customSearchResults=kiwi_customSearchResults,null==setWith_urlResults?(console.log("_set_popupParcel called with undefined responses (not supposed to happen, ever)"),0):(setObj_popupParcel.allPreppedResults=setWith_urlResults,tabUrl===forUrl?(setObj_popupParcel.tabInfo={},setObj_popupParcel.tabInfo.tabUrl=tabUrl,setObj_popupParcel.tabInfo.tabTitle=tabTitleObject.tabTitle):setObj_popupParcel.tabInfo=null,setObj_popupParcel.urlBlocked=!1,isUrlBlocked=is_url_blocked(allItemsInSyncedStorage.kiwi_userPreferences.urlSubstring_blacklists,tabUrl),isUrlBlocked===!0&&(setObj_popupParcel.urlBlocked=!0),oldUrl===!0?setObj_popupParcel.oldUrl=!0:setObj_popupParcel.oldUrl=!1,popupParcel=setObj_popupParcel,sendPopupParcel?(parcel={},parcel.msg="kiwiPP_popupParcel_ready",parcel.forUrl=tabUrl,parcel.popupParcel=setObj_popupParcel,sendParcel(parcel)):void 0)}))},setPreppedServiceResults=function(responsePackage,servicesInfo){var completedQueryServicesArray,currentTime,numberOfActiveServices,sendPopupParcel,service,serviceInfo,serviceName,serviceObj,service_PreppedResults,_i,_len,_ref,_ref1;if(currentTime=Date.now(),tabUrl===responsePackage.forUrl){for(_i=0,_len=servicesInfo.length;_len>_i;_i++)serviceObj=servicesInfo[_i],serviceObj.name===responsePackage.serviceName&&(serviceInfo=serviceObj);if(service_PreppedResults=parseResults[responsePackage.serviceName](responsePackage.queryResult,responsePackage.forUrl,serviceInfo),null==tempResponsesStore.services&&(tempResponsesStore={},tempResponsesStore.services={}),tempResponsesStore.services[responsePackage.serviceName]={timestamp:currentTime,service_PreppedResults:service_PreppedResults,forUrl:responsePackage.forUrl},numberOfActiveServices=returnNumberOfActiveServices(servicesInfo),completedQueryServicesArray=[],tempResponsesStore.forUrl===tabUrl){_ref=tempResponsesStore.services;for(serviceName in _ref)service=_ref[serviceName],completedQueryServicesArray.push(serviceName)}if(null!=kiwi_urlsResultsCache[tabUrl]){_ref1=kiwi_urlsResultsCache[tabUrl];for(serviceName in _ref1)service=_ref1[serviceName],completedQueryServicesArray.push(serviceName)}return completedQueryServicesArray=_.uniq(completedQueryServicesArray),completedQueryServicesArray.length===numberOfActiveServices&&0!==numberOfActiveServices?(kiwi_urlsResultsCache=_save_url_results(servicesInfo,tempResponsesStore,kiwi_urlsResultsCache),_save_historyBlob(kiwi_urlsResultsCache,tabUrl),sendPopupParcel=popupOpen?!0:!1,_set_popupParcel(kiwi_urlsResultsCache[tabUrl],responsePackage.forUrl,sendPopupParcel),refreshBadge(servicesInfo,kiwi_urlsResultsCache[tabUrl])):(_set_popupParcel(tempResponsesStore.services,responsePackage.forUrl,!1),refreshBadge(servicesInfo,tempResponsesStore.services))}},parseResults={reddit:function(resultsObj,searchQueryString,serviceInfo,customSearchBool){var child,listingKeys,matchedListings,preppedResult,_i,_len,_ref;if(null==customSearchBool&&(customSearchBool=!1),matchedListings=[],null!=resultsObj.kind&&"Listing"===resultsObj.kind&&null!=resultsObj.data&&null!=resultsObj.data.children&&resultsObj.data.children.length>0)for(_ref=resultsObj.data.children,_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],null!=child.data&&(listingKeys=["subreddit","url","score","domain","gilded","over_18","author","hidden","downs","permalink","created","title","created_utc","ups","num_comments"],preppedResult=_.pick(child.data,listingKeys),preppedResult.kiwi_created_at=1e3*preppedResult.created_utc,customSearchBool===!1?preppedResult.kiwi_exact_match=_exact_match_url_check(searchQueryString,preppedResult.url):preppedResult.kiwi_exact_match=!0,preppedResult.kiwi_score=preppedResult.score,preppedResult.kiwi_permaId=preppedResult.permalink,matchedListings.push(preppedResult));return matchedListings},hackerNews:function(resultsObj,searchQueryString,serviceInfo,customSearchBool){var hit,listingKeys,matchedListings,preppedResult,_i,_len,_ref;if(null==customSearchBool&&(customSearchBool=!1),matchedListings=[],null!=resultsObj.hits)for(_ref=resultsObj.hits,_i=0,_len=_ref.length;_len>_i;_i++)hit=_ref[_i],listingKeys=["points","num_comments","objectID","author","created_at","title","url","created_at_i","story_text","comment_text","story_id","story_title","story_url"],preppedResult=_.pick(hit,listingKeys),preppedResult.kiwi_created_at=1e3*preppedResult.created_at_i,customSearchBool===!1?preppedResult.kiwi_exact_match=_exact_match_url_check(searchQueryString,preppedResult.url):preppedResult.kiwi_exact_match=!0,preppedResult.kiwi_score=preppedResult.points,preppedResult.kiwi_permaId=preppedResult.objectID,matchedListings.push(preppedResult);return matchedListings},gnews:function(resultsObj,searchQueryString,serviceInfo,customSearchBool){var child,currentTime,forUrl,listing,listingKeys,matchedListings,noteworthy,preppedResult,__numberOfRelatedItemsWithClusterURL,__numberOfStoriesFoundWithinTheHoursSincePostedLimit,_i,_j,_k,_len,_len1,_len2;if(null==customSearchBool&&(customSearchBool=!1),customSearchBool===!1){for(forUrl=searchQueryString,matchedListings=[],_i=0,_len=resultsObj.length;_len>_i;_i++)child=resultsObj[_i],listingKeys=["clusterUrl","publisher","content","publishedDate","unescapedUrl","titleNoFormatting"],preppedResult=_.pick(child,listingKeys),preppedResult.kiwi_created_at=Date.parse(preppedResult.publishedDate),preppedResult.kiwi_exact_match=!1,preppedResult.kiwi_score=null,preppedResult.kiwi_permaId=preppedResult.unescapedUrl,customSearchBool===!1?preppedResult.kiwi_exact_match=_exact_match_url_check(forUrl,preppedResult.url):preppedResult.kiwi_exact_match=!0,preppedResult.kiwi_searchedFor=tabTitleObject.tabTitle,preppedResult.unescapedUrl!==forUrl?matchedListings.push(preppedResult):""!==preppedResult.clusterUrl&&matchedListings.push(preppedResult);for(currentTime=Date.now(),noteworthy=!1,__numberOfStoriesFoundWithinTheHoursSincePostedLimit=0,__numberOfRelatedItemsWithClusterURL=0,_j=0,_len1=matchedListings.length;_len1>_j;_j++)listing=matchedListings[_j],null!=listing.clusterUrl&&""!==listing.clusterUrl&&__numberOfRelatedItemsWithClusterURL++,
currentTime-listing.kiwi_created_at<36e5*serviceInfo.notableConditions.hoursSincePosted&&__numberOfStoriesFoundWithinTheHoursSincePostedLimit++;return __numberOfStoriesFoundWithinTheHoursSincePostedLimit>=serviceInfo.notableConditions.numberOfStoriesFoundWithinTheHoursSincePostedLimit&&(noteworthy=!0),__numberOfRelatedItemsWithClusterURL>=serviceInfo.notableConditions.numberOfRelatedItemsWithClusterURL&&(noteworthy=!0),noteworthy&&(matchedListings[0].kiwi_exact_match=!0),matchedListings}for(matchedListings=[],_k=0,_len2=resultsObj.length;_len2>_k;_k++)child=resultsObj[_k],listingKeys=["clusterUrl","publisher","content","publishedDate","unescapedUrl","titleNoFormatting"],preppedResult=_.pick(child,listingKeys),preppedResult.kiwi_created_at=Date.parse(preppedResult.publishedDate),preppedResult.kiwi_exact_match=!1,preppedResult.kiwi_score=null,preppedResult.kiwi_permaId=preppedResult.unescapedUrl,preppedResult.kiwi_searchedFor=searchQueryString,preppedResult.kiwi_exact_match=!1,matchedListings.push(preppedResult);return matchedListings}},_exact_match_url_check=function(forUrl,preppedResultUrl){var altUrl,cSindex,checkArray,checkString,existState,existState_,existState_Char,existState__,existStates,forUrlUnmodded,forUrl_,index,index_,kiwi_exact_match,m,mod,modKey,modPermutations,mod_,moddedUrl,modifications,_i,_j,_k,_l,_len,_len1,_len2,_len3,_len4,_len5,_len6,_len7,_m,_n,_o,_p;for(kiwi_exact_match=!1,modifications=[{name:"trailingSlash",modify:function(tOrF,forUrl){var noTrailingSlashURL,trailingSlashURL;return"t"===tOrF?trailingSlashURL="/"!==forUrl[forUrl.length-1]?forUrl+"/":forUrl:noTrailingSlashURL="/"===forUrl[forUrl.length-1]?forUrl.substr(0,forUrl.length-1):forUrl},existsTest:function(forUrl){return"/"===forUrl[forUrl.length-1]?"t":"f"}},{name:"www",modify:function(tOrF,forUrl){var WWWurl,noWWWurl,protocolSplitUrlArray,wwwSplitUrlArray;return"t"===tOrF?(protocolSplitUrlArray=forUrl.split("://"),protocolSplitUrlArray.length>1?(0!==protocolSplitUrlArray[1].indexOf("www.")?(protocolSplitUrlArray[1]="www."+protocolSplitUrlArray[1],WWWurl=protocolSplitUrlArray.join("://")):WWWurl=forUrl,WWWurl):(0!==protocolSplitUrlArray[0].indexOf("www.")?(protocolSplitUrlArray[0]="www."+protocolSplitUrlArray[1],WWWurl=protocolSplitUrlArray.join("://")):WWWurl=forUrl,WWWurl)):(wwwSplitUrlArray=forUrl.split("www."),2===wwwSplitUrlArray.length?noWWWurl=wwwSplitUrlArray.join(""):wwwSplitUrlArray.length>2?(noWWWurl=wwwSplitUrlArray.shift(),noWWWurl+=wwwSplitUrlArray.shift(),noWWWurl+=wwwSplitUrlArray.join("www.")):noWWWurl=forUrl,noWWWurl)},existsTest:function(forUrl){return forUrl.split("//www.").length>0?"t":"f"}},{name:"http",existsTest:function(forUrl){return 0===forUrl.indexOf("http://")?"t":"f"},modify:function(tOrF,forUrl){var HTTPSurl,HTTPurl;return"t"===tOrF?HTTPurl=0===forUrl.indexOf("https://")?"http://"+forUrl.substr(8,forUrl.length-1):forUrl:HTTPSurl=0===forUrl.indexOf("http://")?"https://"+forUrl.substr(7,forUrl.length-1):forUrl}}],modPermutations={},forUrlUnmodded="",_i=0,_len=modifications.length;_len>_i;_i++)mod=modifications[_i],forUrlUnmodded+=mod.existsTest(forUrl);for(modPermutations[forUrlUnmodded]=forUrl,existStates=["t","f"],_j=0,_len1=existStates.length;_len1>_j;_j++)for(existState=existStates[_j],index=_k=0,_len2=modifications.length;_len2>_k;index=++_k){for(mod=modifications[index],checkArray=[],_l=0,_len3=modifications.length;_len3>_l;_l++)m=modifications[_l],checkArray.push(existState);for(forUrl_=modifications[index].modify(existState,forUrl),_m=0,_len4=existStates.length;_len4>_m;_m++)for(existState_=existStates[_m],checkArray[index]=existState_,index_=_n=0,_len5=modifications.length;_len5>_n;index_=++_n)if(mod_=modifications[index_],index!==index_)for(_o=0,_len6=existStates.length;_len6>_o;_o++)if(existState__=existStates[_o],checkArray[index_]=existState__,checkString=checkArray.join(""),null==modPermutations[checkString]){for(altUrl=forUrl_,cSindex=_p=0,_len7=checkString.length;_len7>_p;cSindex=++_p)existState_Char=checkString[cSindex],altUrl=modifications[cSindex].modify(existState_Char,altUrl);modPermutations[checkString]=altUrl}}kiwi_exact_match=!1,preppedResultUrl===forUrl&&(kiwi_exact_match=!0);for(modKey in modPermutations)moddedUrl=modPermutations[modKey],preppedResultUrl===moddedUrl&&(kiwi_exact_match=!0);return kiwi_exact_match},refreshBadge=function(servicesInfo,resultsObjForCurrentUrl){var abbreviationLettersArray,badgeText,currentTime,exactMatch,index,listing,noteworthy,service,_i,_j,_len,_len1,_ref;for(currentTime=Date.now(),abbreviationLettersArray=[],index=_i=0,_len=servicesInfo.length;_len>_i;index=++_i)if(service=servicesInfo[index],"gnews"===service.name)null!=resultsObjForCurrentUrl[service.name]&&resultsObjForCurrentUrl[service.name].service_PreppedResults.length>0&&(noteworthy=!1,resultsObjForCurrentUrl[service.name].service_PreppedResults[0].kiwi_exact_match===!0&&(noteworthy=!0),noteworthy&&abbreviationLettersArray.push(service.abbreviation));else if(null!=resultsObjForCurrentUrl[service.name]&&resultsObjForCurrentUrl[service.name].service_PreppedResults.length>0){for(exactMatch=!1,noteworthy=!1,_ref=resultsObjForCurrentUrl[service.name].service_PreppedResults,_j=0,_len1=_ref.length;_len1>_j;_j++)if(listing=_ref[_j],listing.kiwi_exact_match){if(exactMatch=!0,null!=listing.num_comments&&listing.num_comments>=service.notableConditions.num_comments){noteworthy=!0;break}if(currentTime-listing.kiwi_created_at<36e5*service.notableConditions.hoursSincePosted){noteworthy=!0;break}}if(service.updateBadgeOnlyWithExactMatch&&(exactMatch=!1))break;abbreviationLettersArray.push(noteworthy?service.abbreviation:service.abbreviation.toLowerCase())}return badgeText="",0===abbreviationLettersArray.length?chrome.storage.sync.get(null,function(allItemsInSyncedStorage){return null!=allItemsInSyncedStorage.kiwi_userPreferences&&"off"===allItemsInSyncedStorage.kiwi_userPreferences.researchModeOnOff?badgeText="off":"off"===defaultUserPreferences.researchModeOnOff?badgeText="off":void 0}):badgeText=abbreviationLettersArray.join(" "),updateBadgeText(badgeText)},updateBadgeText=function(text){return chrome.browserAction.setBadgeText({text:text.toString()})},periodicCleanup=function(tab,allItemsInLocalStorage,allItemsInSyncedStorage,initialize_callback){var cull_kiwi_urlsResultsCache,currentTime,deletedCount,num_results_to_delete,serviceKey,serviceResults,url,urlServiceResults;if(currentTime=Date.now(),currentTime-CLEANUP_INTERVAL>last_periodicCleanup){if(last_periodicCleanup=currentTime,0===Object.keys(kiwi_urlsResultsCache).length)return initialize_callback(tab,allItemsInLocalStorage,allItemsInSyncedStorage);cull_kiwi_urlsResultsCache=_.extend({},kiwi_urlsResultsCache);for(url in cull_kiwi_urlsResultsCache){urlServiceResults=cull_kiwi_urlsResultsCache[url];for(serviceKey in urlServiceResults)serviceResults=urlServiceResults[serviceKey],currentTime-serviceResults.timestamp>checkForUrlHourInterval&&delete kiwi_urlsResultsCache[url]}if(Object.keys(kiwi_urlsResultsCache).length>maxUrlResultsStoredInLocalStorage){num_results_to_delete=Object.keys(kiwi_urlsResultsCache).length-maxUrlResultsStoredInLocalStorage,deletedCount=0,cull_kiwi_urlsResultsCache=_.extend({},kiwi_urlsResultsCache);for(url in cull_kiwi_urlsResultsCache){if(urlServiceResults=cull_kiwi_urlsResultsCache[url],deleteCount>=num_results_to_delete)break;url!==tab.url&&(delete kiwi_urlsResultsCache[url],deletedCount++)}return initialize_callback(tab,allItemsInLocalStorage,allItemsInSyncedStorage)}return initialize_callback(tab,allItemsInLocalStorage,allItemsInSyncedStorage)}return initialize_callback(tab,allItemsInLocalStorage,allItemsInSyncedStorage)},_save_from_popupParcel=function(_popupParcel,forUrl,updateToView){var formerKiwi_servicesInfo,formerResearchModeValue,former_autoOffTimerType,former_autoOffTimerValue,resetTimerBool,_autoOffAtUTCmilliTimestamp;return formerResearchModeValue=null,formerKiwi_servicesInfo=null,former_autoOffTimerType=null,former_autoOffTimerValue=null,console.log("#console.debug popupParcel console.debug _popupParcel"),console.debug(popupParcel),console.debug(_popupParcel),null!=popupParcel&&null!=popupParcel.kiwi_userPreferences&&popupParcel.kiwi_servicesInfo&&(formerResearchModeValue=popupParcel.kiwi_userPreferences.researchModeOnOff,formerKiwi_servicesInfo=popupParcel.kiwi_servicesInfo,former_autoOffTimerType=popupParcel.kiwi_userPreferences.autoOffTimerType,former_autoOffTimerValue=popupParcel.kiwi_userPreferences.autoOffTimerValue),popupParcel={},console.log(" asdfasdfasd formerKiwi_autoOffTimerType"),console.log(former_autoOffTimerType),console.log(_popupParcel.kiwi_userPreferences.autoOffTimerType),console.log(" a;woeifjaw;ef formerKiwi_autoOffTimerValue"),console.log(former_autoOffTimerValue),console.log(_popupParcel.kiwi_userPreferences.autoOffTimerValue),resetTimerBool=null!=formerResearchModeValue&&"off"===formerResearchModeValue&&null!=_popupParcel.kiwi_userPreferences&&"on"===_popupParcel.kiwi_userPreferences.researchModeOnOff||former_autoOffTimerType!==_popupParcel.kiwi_userPreferences.autoOffTimerType||former_autoOffTimerValue!==_popupParcel.kiwi_userPreferences.autoOffTimerValue?!0:!1,_autoOffAtUTCmilliTimestamp=setAutoOffTimer(resetTimerBool,_popupParcel.kiwi_userPreferences.autoOffAtUTCmilliTimestamp,_popupParcel.kiwi_userPreferences.autoOffTimerValue,_popupParcel.kiwi_userPreferences.autoOffTimerType,_popupParcel.kiwi_userPreferences.researchModeOnOff),_popupParcel.kiwi_userPreferences.autoOffAtUTCmilliTimestamp=_autoOffAtUTCmilliTimestamp,chrome.storage.sync.set({kiwi_userPreferences:_popupParcel.kiwi_userPreferences},function(){return chrome.storage.sync.set({kiwi_servicesInfo:_popupParcel.kiwi_servicesInfo},function(){var formerActiveServicesList,newActiveServicesList,parcel;return null!=updateToView&&(parcel={},popupParcel=_popupParcel,parcel.msg="kiwiPP_popupParcel_ready",parcel.forUrl=tabUrl,parcel.popupParcel=_popupParcel,sendParcel(parcel)),_popupParcel.forUrl===tabUrl?null!=formerResearchModeValue&&"off"===formerResearchModeValue&&null!=_popupParcel.kiwi_userPreferences&&"on"===_popupParcel.kiwi_userPreferences.researchModeOnOff?(initIfNewURL(!0),0):null!=formerKiwi_servicesInfo?(formerActiveServicesList=_.pluck(formerKiwi_servicesInfo,"active"),newActiveServicesList=_.pluck(_popupParcel.kiwi_servicesInfo,"active"),_.isEqual(formerActiveServicesList,newActiveServicesList)?(refreshBadge(_popupParcel.kiwi_servicesInfo,_popupParcel.allPreppedResults),0):(initIfNewURL(!0),0)):(refreshBadge(_popupParcel.kiwi_servicesInfo,_popupParcel.allPreppedResults),0):void 0})})},setAutoOffTimer=function(resetTimerBool,autoOffAtUTCmilliTimestamp,autoOffTimerValue,autoOffTimerType,researchModeOnOff){var currentTime,new_autoOffAtUTCmilliTimestamp;if(resetTimerBool&&null!=kiwi_autoOffClearInterval&&(clearTimeout(kiwi_autoOffClearInterval),kiwi_autoOffClearInterval=null),currentTime=Date.now(),new_autoOffAtUTCmilliTimestamp=null,"on"===researchModeOnOff){if(null!==autoOffAtUTCmilliTimestamp&&!resetTimerBool)return new_autoOffAtUTCmilliTimestamp=autoOffAtUTCmilliTimestamp,null==kiwi_autoOffClearInterval&&autoOffAtUTCmilliTimestamp>currentTime&&(kiwi_autoOffClearInterval=setTimeout(turnResearchModeOff,new_autoOffAtUTCmilliTimestamp-currentTime)),new_autoOffAtUTCmilliTimestamp;"20"===autoOffTimerType?new_autoOffAtUTCmilliTimestamp=currentTime+12e5:"60"===autoOffTimerType?new_autoOffAtUTCmilliTimestamp=currentTime+36e5:"always"===autoOffTimerType?new_autoOffAtUTCmilliTimestamp=null:"custom"===autoOffTimerType&&(new_autoOffAtUTCmilliTimestamp=currentTime+60*parseInt(autoOffTimerValue)*1e3)}else new_autoOffAtUTCmilliTimestamp=null,null!=kiwi_autoOffClearInterval&&(clearTimeout(kiwi_autoOffClearInterval),kiwi_autoOffClearInterval=null);return null!==new_autoOffAtUTCmilliTimestamp&&(kiwi_autoOffClearInterval=setTimeout(turnResearchModeOff,new_autoOffAtUTCmilliTimestamp-currentTime)),new_autoOffAtUTCmilliTimestamp},turnResearchModeOff=function(){return chrome.storage.sync.get(null,function(allItemsInSyncedStorage){var urlResults;return urlResults=null!=kiwi_urlsResultsCache[tabUrl]?kiwi_urlsResultsCache[tabUrl]:{},null!=allItemsInSyncedStorage.kiwi_userPreferences?(allItemsInSyncedStorage.kiwi_userPreferences.researchModeOnOff="off",chrome.storage.sync.set({kiwi_userPreferences:allItemsInSyncedStorage.kiwi_userPreferences},function(){return _set_popupParcel(urlResults,tabUrl,!0),null!=allItemsInSyncedStorage.kiwi_servicesInfo?refreshBadge(allItemsInSyncedStorage.kiwi_servicesInfo,urlResults):void 0})):(defaultUserPreferences.researchModeOnOff="off",chrome.storage.sync.set({kiwi_userPreferences:defaultUserPreferences},function(){return _set_popupParcel(urlResults,tabUrl,!0),null!=allItemsInSyncedStorage.kiwi_servicesInfo?refreshBadge(allItemsInSyncedStorage.kiwi_servicesInfo,urlResults):void 0}))})},initIfNewURL=function(overrideSameURLCheck_popupOpen,overrideResearchModeOff){var currentTime;return null==overrideSameURLCheck_popupOpen&&(overrideSameURLCheck_popupOpen=!1),null==overrideResearchModeOff&&(overrideResearchModeOff=!1),"boolean"!=typeof overrideSameURLCheck_popupOpen&&(overrideSameURLCheck_popupOpen=!1),popupOpen=overrideSameURLCheck_popupOpen?!0:!1,currentTime=Date.now(),chrome.tabs.query({currentWindow:!0,active:!0},function(tabs){var tabUrl_hash,tabUrl_hashWordArray,title;return tabs.length>0&&null!=tabs[0].url?0===tabs[0].url.indexOf("chrome-devtools://")?(_set_popupParcel({},tabUrl,!1),0):(tabUrl=tabs[0].url,"complete"===tabs[0].status?(title=tabs[0].title,title.length>3&&"("===title[0]&&isNaN(title[1])===!1&&-1!==title.indexOf(")")&&title.indexOf(")")!==title.length-1&&(title=title.slice(title.indexOf(")")+1,title.length).trim()),tabTitleObject={tabTitle:title,forUrl:tabUrl}):tabTitleObject={tabTitle:null,forUrl:tabUrl},tabUrl_hashWordArray=CryptoJS.SHA512(tabUrl),tabUrl_hash=tabUrl_hashWordArray.toString(CryptoJS.enc.Latin1),chrome.storage.local.get(null,function(allItemsInLocalStorage){var historyString,sameURLCheck;return sameURLCheck=!0,historyString=reduceHashByHalf(tabUrl_hash),null==allItemsInLocalStorage.persistentUrlHash&&(allItemsInLocalStorage.persistentUrlHash=""),overrideSameURLCheck_popupOpen!==!1||null==allItemsInLocalStorage.kiwi_historyBlob||-1===allItemsInLocalStorage.kiwi_historyBlob.indexOf(historyString)||null!=kiwi_urlsResultsCache&&null!=kiwi_urlsResultsCache[tabUrl]?overrideSameURLCheck_popupOpen===!1&&null==allItemsInLocalStorage.persistentUrlHash||null!=allItemsInLocalStorage.persistentUrlHash&&allItemsInLocalStorage.persistentUrlHash!==tabUrl_hash?sameURLCheck=!1:overrideSameURLCheck_popupOpen===!0&&(sameURLCheck=!1):(updateBadgeText("old"),sameURLCheck=!0,_set_popupParcel({},tabUrl,!1,null,!0)),chrome.storage.local.set({persistentUrlHash:tabUrl_hash},function(){}),sameURLCheck===!1?(updateBadgeText(""),chrome.storage.sync.get(null,function(allItemsInSyncedStorage){return null!=allItemsInSyncedStorage.kiwi_userPreferences&&(null!=allItemsInSyncedStorage.kiwi_userPreferences.autoOffAtUTCmilliTimestamp&&currentTime>allItemsInSyncedStorage.kiwi_userPreferences.autoOffAtUTCmilliTimestamp&&(allItemsInSyncedStorage.kiwi_userPreferences.researchModeOnOff="off"),"off"===allItemsInSyncedStorage.kiwi_userPreferences.researchModeOnOff&&overrideResearchModeOff===!1)?(updateBadgeText("off"),tabUrl===tempResponsesStore.forUrl?null!=kiwi_urlsResultsCache[tabUrl]&&(_set_popupParcel(kiwi_urlsResultsCache[tabUrl],tabUrl,!1),null!=allItemsInSyncedStorage.kiwi_servicesInfo&&refreshBadge(allItemsInSyncedStorage.kiwi_servicesInfo,kiwi_urlsResultsCache[tabUrl])):_set_popupParcel({},tabUrl,!1),0):periodicCleanup(tabUrl,allItemsInLocalStorage,allItemsInSyncedStorage,function(tabUrl,allItemsInLocalStorage,allItemsInSyncedStorage){var isUrlBlocked,setObj,_autoOffAtUTCmilliTimestamp;return null==allItemsInSyncedStorage.kiwi_userPreferences?(_autoOffAtUTCmilliTimestamp=setAutoOffTimer(!1,defaultUserPreferences.autoOffAtUTCmilliTimestamp,defaultUserPreferences.autoOffTimerValue,defaultUserPreferences.autoOffTimerType,defaultUserPreferences.researchModeOnOff),defaultUserPreferences.autoOffAtUTCmilliTimestamp=_autoOffAtUTCmilliTimestamp,setObj={kiwi_servicesInfo:defaultServicesInfo,kiwi_userPreferences:defaultUserPreferences},chrome.storage.sync.set(setObj,function(){var isUrlBlocked;return isUrlBlocked=is_url_blocked(defaultUserPreferences.urlSubstring_blacklists,tabUrl),isUrlBlocked===!0&&overrideResearchModeOff===!1?(updateBadgeText("block"),_set_popupParcel({},tabUrl,!0),0):initialize(tabUrl)})):(isUrlBlocked=is_url_blocked(allItemsInSyncedStorage.kiwi_userPreferences.urlSubstring_blacklists,tabUrl),isUrlBlocked===!0&&overrideResearchModeOff===!1?(updateBadgeText("block"),_set_popupParcel({},tabUrl,!0),0):initialize(tabUrl))})})):void 0})):void 0})},chrome.tabs.onActivated.addListener(function(){return initIfNewURL()}),chrome.tabs.onUpdated.addListener(function(tabId,info){return updateBadgeText(""),null==tabTitleObject||tabTitleObject.forUrl!==tabUrl||null!=tabTitleObject.tabTitle?initIfNewURL():"complete"===info.status?(initIfNewURL(!0),0):void 0}),chrome.windows.onFocusChanged.addListener(function(){return initIfNewURL()}),null===tabTitleObject&&initIfNewURL(!0),getRandom=function(min,max){return min+Math.floor(Math.random()*(max-min+1))},reduceHashByHalf=function(hash,reducedByAFactorOf){var counter,finalHash,reduceStringByHalf;for(null==reducedByAFactorOf&&(reducedByAFactorOf=1),reduceStringByHalf=function(_string_){var char,index,newShortenedString,_i,_len;for(newShortenedString="",index=_i=0,_len=_string_.length;_len>_i;index=++_i)char=_string_[index],index%2===0&&_string_.length-1>index+1&&(char=char>_string_[index+1]?char:_string_[index+1],newShortenedString+=char);return newShortenedString},finalHash="",counter=0;reducedByAFactorOf>counter;)hash=reduceStringByHalf(hash),counter++;return hash}}).call(this);